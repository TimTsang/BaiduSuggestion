<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Baidusuggestion by TimTsang</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Baidusuggestion</h1>
        <h2>JavaScript</h2>
        <a href="https://github.com/TimTsang/BaiduSuggestion" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="baidusuggestion" class="anchor" href="#baidusuggestion"><span class="octicon octicon-link"></span></a>BaiduSuggestion</h1>

<h1>
<a name="javascript%E5%AE%9E%E7%8E%B0%E7%99%BE%E5%BA%A6%E6%90%9C%E7%B4%A2suggestion%E5%8A%9F%E8%83%BD" class="anchor" href="#javascript%E5%AE%9E%E7%8E%B0%E7%99%BE%E5%BA%A6%E6%90%9C%E7%B4%A2suggestion%E5%8A%9F%E8%83%BD"><span class="octicon octicon-link"></span></a>JavaScript实现百度搜索suggestion功能</h1>

<hr>

<p>百度搜索suggestion功能增强了用户体验，现在很多带有搜索功能的网站都会有类似搜索suggestion功能，用以增强用户体验。
暑假的时候试着做了一个百度搜索suggestion功能的demo练习，记录一下，以便以后查看。</p>

<p>本文包括以下几个主目录：</p>

<blockquote>
<ul>
<li>
<i></i> 需求分析</li>
<li>
<i></i> 技术分析</li>
<li>
<i></i> 开发工具</li>
<li>
<i></i> 具体的实现过程</li>
</ul>
</blockquote>

<hr>

<h2>
<a name="%E4%B8%80%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90" class="anchor" href="#%E4%B8%80%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="octicon octicon-link"></span></a>一、需求分析</h2>

<p><img src="http://img.blog.csdn.net/20140914104219853?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdGltX3RzYW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="百度suggestion的效果图"></p>

<h3>
<a name="-%E5%9F%BA%E6%9C%AC%E9%9C%80%E6%B1%82" class="anchor" href="#-%E5%9F%BA%E6%9C%AC%E9%9C%80%E6%B1%82"><span class="octicon octicon-link"></span></a>① 基本需求：</h3>

<ol>
<li>在输入框输入关键字后，出现下拉框，下拉框中为suggestion的内容。根据不同的关键字，显示不同的suggestion。</li>
<li>下拉框支持鼠标点选，鼠标移到suggestion的选择项时，要将对应的字段自动填入百度输入框</li>
<li>要对suggestion下拉框进行动态处理，百度输入框失去焦点时，suggestion下拉框要自动消失。</li>
<li>下拉框支持上下键切换，键盘的上下键可对下拉框中的suggestion选项进行选择，当前选项应该自动填入百度输入框。</li>
</ol>

<h3>
<a name="-%E6%89%A9%E5%B1%95%E9%9C%80%E6%B1%82" class="anchor" href="#-%E6%89%A9%E5%B1%95%E9%9C%80%E6%B1%82"><span class="octicon octicon-link"></span></a>② 扩展需求：</h3>

<ol>
<li>suggestion数据来时百度（jsonp跨域请求js）</li>
<li>点击“百度一下”按钮可进行百度搜索。</li>
<li>按回车键可对单前百度输入框中的字段进行搜索。</li>
</ol>

<hr>

<h2>
<a name="%E4%BA%8C%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90" class="anchor" href="#%E4%BA%8C%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90"><span class="octicon octicon-link"></span></a>二、技术分析</h2>

<ol>
<li>根据suggestion字段内容，动态生成对应的suggestion下拉框，这里需要用到Dom节点的操作。</li>
<li>鼠标点选，这里需要触发鼠标事件。</li>
<li>键盘上下键选择，这里需要触发键盘事件</li>
<li>动态改变CSS样式</li>
<li>向百度后台发jsonp请求，跨域请求js。</li>
</ol>

<hr>

<h2>
<a name="%E4%B8%89%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7" class="anchor" href="#%E4%B8%89%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7"><span class="octicon octicon-link"></span></a>三、开发工具</h2>

<ol>
<li>Sublime Text</li>
<li>FireFox浏览器</li>
</ol>

<hr>

<h2>
<a name="%E5%9B%9B%E5%85%B7%E4%BD%93%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B" class="anchor" href="#%E5%9B%9B%E5%85%B7%E4%BD%93%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B"><span class="octicon octicon-link"></span></a>四、具体的实现过程</h2>

<h3>
<a name="-%E9%9B%8F%E5%BD%A2%E9%98%B6%E6%AE%B5suggestion%E6%95%B0%E6%8D%AE%E6%9D%A5%E8%87%AA%E6%9C%AC%E5%9C%B0" class="anchor" href="#-%E9%9B%8F%E5%BD%A2%E9%98%B6%E6%AE%B5suggestion%E6%95%B0%E6%8D%AE%E6%9D%A5%E8%87%AA%E6%9C%AC%E5%9C%B0"><span class="octicon octicon-link"></span></a>① 雏形阶段（suggestion数据来自本地）</h3>

<ol>
<li>构建基本页面
<em>关键代码片段：</em>
</li>
</ol>

<div class="highlight highlight-html"><pre><span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"form"</span> <span class="na">name=</span><span class="s">"myForm"</span><span class="nt">&gt;</span>  
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"span_search"</span><span class="nt">&gt;</span>  
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"input_search"</span> <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">maxlength=</span><span class="s">"100"</span> <span class="na">name=</span><span class="s">"value_search"</span> <span class="na">onkeyup=</span><span class="s">"keyEvent(event);"</span><span class="nt">&gt;</span>  
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"suggestion_div"</span><span class="nt">&gt;</span>   
            <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">"suggestions_ul"</span><span class="nt">&gt;&lt;/ul&gt;</span>   
        <span class="nt">&lt;/div&gt;</span>   
    <span class="nt">&lt;/div&gt;</span>  
    <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"input_button"</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"百度一下"</span> <span class="nt">&gt;</span>  
<span class="nt">&lt;/form&gt;</span>  
</pre></div>

<ol>
<li>动态添加下拉框
<em>1）声明并初始化全局变量（动态添加下拉框的几个很重要的变量）</em>
</li>
</ol>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">inputField</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="s2">"myForm"</span><span class="p">].</span><span class="nx">input_search</span><span class="p">;</span>  
<span class="kd">var</span> <span class="nx">suggestionDiv</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"suggestion_div"</span><span class="p">);</span>  
<span class="kd">var</span> <span class="nx">suggestionsUl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"suggestions_ul"</span><span class="p">);</span>   
<span class="kd">var</span> <span class="nx">suggestionLi</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> 
</pre></div>

<p><em>2）初始化数据源</em></p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">suggestion</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"abcde"</span><span class="p">,</span><span class="s2">"华南理工大学"</span><span class="p">,</span><span class="s2">"abcd"</span><span class="p">,</span><span class="s2">"华南师范大学"</span><span class="p">,</span><span class="s2">"abcdefg"</span><span class="p">,</span><span class="s2">"华南农业大学"</span><span class="p">,</span><span class="s2">"abcdefgh"</span><span class="p">,</span><span class="s2">"广东工业大学"</span><span class="p">,</span><span class="s2">"广东外语外贸大学"</span><span class="p">,</span><span class="s2">"计算机科学与技术"</span><span class="p">,</span><span class="s2">"广东财经大学"</span><span class="p">,</span><span class="s2">"计算机学院"</span><span class="p">,</span><span class="s2">"广州医科大学"</span><span class="p">,</span><span class="s2">"计算机"</span><span class="p">,</span><span class="s2">"广州大学"</span><span class="p">];</span><span class="c1">//模拟的数据源  </span>
<span class="nx">suggestion</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span> <span class="c1">// 按字母排序，使显示结果更友好  </span>
</pre></div>

<p><em>3）动态生成下拉列表</em></p>

<div class="highlight highlight-javascript"><pre><span class="kd">function</span> <span class="nx">setSuggestions</span><span class="p">(</span><span class="nx">the_suggestions</span><span class="p">)</span> <span class="p">{</span><span class="c1">// 动态生成suggestion下拉框  </span>
    <span class="nx">clearSuggestions</span><span class="p">();</span> <span class="c1">// 每输入一个字符就先清除原先的提示  </span>
    <span class="nx">suggestionDiv</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">"show"</span><span class="p">;</span>  
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">the_suggestions</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span><span class="c1">// 将匹配的提示结果逐一显示给用户  </span>
        <span class="nx">suggestionLi</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"li"</span><span class="p">);</span>  
        <span class="nx">suggestionsUl</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">suggestionLi</span><span class="p">);</span>  
        <span class="nx">suggestionLi</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">the_suggestions</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>  
        <span class="nx">mouseEvent</span><span class="p">();</span><span class="c1">// 对每个&lt;li&gt;触发鼠标事件  </span>
    <span class="p">}</span>  
<span class="p">}</span>  
</pre></div>

<p><em>4）鼠标事件</em></p>

<div class="highlight highlight-javascript"><pre><span class="kd">function</span> <span class="nx">mouseEvent</span><span class="p">(){</span>  
    <span class="nx">suggestionLi</span><span class="p">.</span><span class="nx">onmouseover</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>  
        <span class="k">this</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">"mouseOver"</span><span class="p">;</span> <span class="c1">// 鼠标经过时高亮  </span>
        <span class="nx">inputField</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">nodeValue</span><span class="p">;</span><span class="c1">// 同时将当前的选中值赋值给百度输入框  </span>
    <span class="p">}</span>  
    <span class="nx">suggestionLi</span><span class="p">.</span><span class="nx">onmouseout</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>  
        <span class="k">this</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">"mouseOut"</span><span class="p">;</span> <span class="c1">// 离开时恢复原样  </span>
    <span class="p">}</span>  
    <span class="nx">suggestionLi</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="c1">// 用户点击某个匹配项时清除提示框  </span>
        <span class="nx">clearSuggestions</span><span class="p">();</span>   
    <span class="p">}</span>  
<span class="p">}</span>  
</pre></div>

<p><em>5）键盘事件</em></p>

<h5>
<a name="%E8%BF%99%E4%B8%AA%E9%94%AE%E7%9B%98%E4%B8%8A%E4%B8%8B%E9%94%AE%E5%88%87%E6%8D%A2%E6%98%AF%E6%88%91%E5%9C%A8%E5%86%99%E9%9B%8F%E5%BD%A2%E7%89%88%E6%97%B6%E5%86%99%E5%BE%97%E7%9B%B8%E5%AF%B9%E6%AF%94%E8%BE%83%E4%B9%85%E7%9A%84%E4%B8%80%E4%B8%AA%E5%8A%9F%E8%83%BD%E5%88%9A%E5%BC%80%E5%A7%8B%E6%83%B3%E5%88%B0%E5%88%A9%E7%94%A8%E4%B8%80%E4%B8%AA%E6%A0%87%E8%AE%B0%E5%8F%98%E9%87%8F%E6%9D%A5%E8%BF%9B%E8%A1%8C%E5%88%87%E6%8D%A2%E5%90%8E%E6%9D%A5%E5%8F%91%E7%8E%B0%E8%87%AA%E5%B7%B1%E8%B6%8A%E5%86%99%E8%B6%8A%E5%A4%8D%E6%9D%82%E5%B0%B1%E5%8F%AA%E5%A5%BD%E7%99%BE%E5%BA%A6%E4%BA%86%E5%90%8E%E6%9D%A5%E5%8F%91%E7%8E%B0%E7%94%A8%E7%B4%A2%E5%BC%95%E5%80%BC%E6%9B%B4%E5%A5%BD%E7%94%A8%E7%B4%A2%E5%BC%95%E5%80%BC%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%A0%87%E8%AE%B0%E6%AF%8F%E4%B8%80%E4%B8%AA%E4%B8%8D%E5%90%8C%E7%9A%84li" class="anchor" href="#%E8%BF%99%E4%B8%AA%E9%94%AE%E7%9B%98%E4%B8%8A%E4%B8%8B%E9%94%AE%E5%88%87%E6%8D%A2%E6%98%AF%E6%88%91%E5%9C%A8%E5%86%99%E9%9B%8F%E5%BD%A2%E7%89%88%E6%97%B6%E5%86%99%E5%BE%97%E7%9B%B8%E5%AF%B9%E6%AF%94%E8%BE%83%E4%B9%85%E7%9A%84%E4%B8%80%E4%B8%AA%E5%8A%9F%E8%83%BD%E5%88%9A%E5%BC%80%E5%A7%8B%E6%83%B3%E5%88%B0%E5%88%A9%E7%94%A8%E4%B8%80%E4%B8%AA%E6%A0%87%E8%AE%B0%E5%8F%98%E9%87%8F%E6%9D%A5%E8%BF%9B%E8%A1%8C%E5%88%87%E6%8D%A2%E5%90%8E%E6%9D%A5%E5%8F%91%E7%8E%B0%E8%87%AA%E5%B7%B1%E8%B6%8A%E5%86%99%E8%B6%8A%E5%A4%8D%E6%9D%82%E5%B0%B1%E5%8F%AA%E5%A5%BD%E7%99%BE%E5%BA%A6%E4%BA%86%E5%90%8E%E6%9D%A5%E5%8F%91%E7%8E%B0%E7%94%A8%E7%B4%A2%E5%BC%95%E5%80%BC%E6%9B%B4%E5%A5%BD%E7%94%A8%E7%B4%A2%E5%BC%95%E5%80%BC%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%A0%87%E8%AE%B0%E6%AF%8F%E4%B8%80%E4%B8%AA%E4%B8%8D%E5%90%8C%E7%9A%84li"><span class="octicon octicon-link"></span></a>这个键盘上下键切换是我在写雏形版时写得相对比较久的一个功能，刚开始想到利用一个标记变量来进行切换，后来发现自己越写越复杂，就只好百度了，后来发现用索引值更好，用索引值就可以标记每一个不同的<code>&lt;li&gt;</code>
</h5>

<h5>
<a name="%E5%90%91%E4%B8%8A%E5%88%87%E6%8D%A2%E7%9A%84%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86" class="anchor" href="#%E5%90%91%E4%B8%8A%E5%88%87%E6%8D%A2%E7%9A%84%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86"><span class="octicon octicon-link"></span></a>向上切换的关键代码部分：</h5>

<div class="highlight highlight-javascript"><pre><span class="nx">suggestionNodes</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">selectedSuggestion</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">"background-color"</span><span class="p">,</span> <span class="s2">"white"</span><span class="p">);</span><span class="c1">//先将上面一个&lt;li&gt;变成白色  </span>
<span class="nx">selectedSuggestion</span><span class="o">++</span><span class="p">;</span> <span class="c1">// 每向下移一位，selectedSuggestion就+1  </span>
<span class="k">if</span> <span class="p">(</span><span class="nx">selectedSuggestion</span> <span class="o">==</span> <span class="nx">suggestionNodes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>  
    <span class="nx">selectedSuggestion</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="c1">//如果索引值变成suggestionNodes.length，则将索引值指向第一个元素  </span>
<span class="p">}</span>  
<span class="c1">//console.log(selectedSuggestion);  </span>
<span class="nx">suggestionNodes</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">selectedSuggestion</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">"background-color"</span><span class="p">,</span> <span class="s2">"#ebebeb"</span><span class="p">);</span><span class="c1">//再将下面一个&lt;li&gt;变成灰色  </span>
</pre></div>

<h5>
<a name="%E5%90%91%E4%B8%8B%E5%88%87%E6%8D%A2%E7%9A%84%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86" class="anchor" href="#%E5%90%91%E4%B8%8B%E5%88%87%E6%8D%A2%E7%9A%84%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86"><span class="octicon octicon-link"></span></a>向下切换的关键代码部分：</h5>

<div class="highlight highlight-javascript"><pre><span class="nx">suggestionNodes</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">selectedSuggestion</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">"background-color"</span><span class="p">,</span> <span class="s2">"white"</span><span class="p">);</span><span class="c1">//先将下面一个&lt;li&gt;变成白色  </span>
<span class="nx">selectedSuggestion</span><span class="o">--</span><span class="p">;</span><span class="c1">// 每向上移一位，selectedSuggestion就-1  </span>
<span class="k">if</span> <span class="p">(</span><span class="nx">selectedSuggestion</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>  
    <span class="nx">selectedSuggestion</span> <span class="o">=</span> <span class="nx">suggestionNodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span><span class="c1">//如果索引值变成-1，则将索引值指向最后一个元素  </span>
<span class="p">}</span>  
<span class="c1">//console.log(selectedSuggestion);  </span>
<span class="nx">suggestionNodes</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">selectedSuggestion</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">"background-color"</span><span class="p">,</span> <span class="s2">"#ebebeb"</span><span class="p">);</span><span class="c1">//再将上面一个&lt;li&gt;变成灰色    </span>
</pre></div>

<p><em>6）动态显示下拉框</em></p>

<h5>
<a name="%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5" class="anchor" href="#%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5"><span class="octicon octicon-link"></span></a>关键代码片段：</h5>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">aResult</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// 用于存放匹配结果  </span>
<span class="k">if</span> <span class="p">(</span><span class="nx">inputField</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>  
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">suggestion</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span> <span class="c1">// 从数据源中找匹配的数据  </span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">suggestion</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">inputField</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>  
            <span class="nx">aResult</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">suggestion</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span> <span class="c1">// 压入结果  </span>
        <span class="p">}</span>   
    <span class="p">}</span>  
    <span class="k">if</span> <span class="p">(</span><span class="nx">aResult</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// 如果有匹配的数据则显示出来  </span>
        <span class="nx">setSuggestions</span><span class="p">(</span><span class="nx">aResult</span><span class="p">);</span>  
<span class="p">}</span><span class="k">else</span>  
<span class="nx">clearSuggestions</span><span class="p">();</span> <span class="c1">// 此步用作用户输入（Backspace健）将输入框清除完时的处理  </span>
</pre></div>

<h5>
<a name="%E4%BB%A5%E4%B8%8A%E4%B8%BA%E9%9B%8F%E5%BD%A2%E9%98%B6%E6%AE%B5%E7%9A%84%E5%AE%9E%E7%8E%B0" class="anchor" href="#%E4%BB%A5%E4%B8%8A%E4%B8%BA%E9%9B%8F%E5%BD%A2%E9%98%B6%E6%AE%B5%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="octicon octicon-link"></span></a>以上为雏形阶段的实现</h5>

<ol>
<li>雏形阶段的最终结果
<img src="http://img.blog.csdn.net/20140914111514255?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdGltX3RzYW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="雏形阶段的最终结果">
</li>
<li>雏形阶段遇到的问题及解决方法
1）未作用户按（Backspace健）将输入框清除完时的处理，导致用户删除了百度输入框的内容时，suggestion下拉提示框依然存在，影响用户体验。于是在百度输入框没有内容时，作清除suggestion下拉提示框的处理。
2）未作百度输出框失去焦点时的处理，导致用户点击页面其他部分时，suggestion下拉提示框依然存在，影响用户体验。于是在百度输入框失去焦点时，清除suggestion下拉提示框。
3）键盘对suggestion下拉列表的上下切换功能的问题，刚开始想到利用一个标记变量来进行切换，后来发现自己越写越复杂，后来利用索引值实现。</li>
</ol>

<h3>
<a name="%E6%88%90%E7%86%9F%E9%98%B6%E6%AE%B5%E5%8F%91jsonp%E8%B7%A8%E5%9F%9F%E8%AF%B7%E6%B1%82js" class="anchor" href="#%E6%88%90%E7%86%9F%E9%98%B6%E6%AE%B5%E5%8F%91jsonp%E8%B7%A8%E5%9F%9F%E8%AF%B7%E6%B1%82js"><span class="octicon octicon-link"></span></a>②成熟阶段（发jsonp，跨域请求js）</h3>

<ol>
<li>自己的一些想法
在做完雏形之前，我的想法如下：
输入字段进行搜索时，触发onkeyup事件异步向后台传值，从后台中搜索到相应值后，后台向前端传入值（当时想到利用JSON），前端解析JSON后在搜索框下动态生成下拉框。后来想还是想在本地模拟个数据做个雏形（PS；因为前端接到后台传来的JSON对象也是要解析才能用的，在suggestion这个功能中，需要将所有的suggestion数据封装在一个数组里面，所以，我就直接模拟了一个数组，而没有模拟JSON数据，模拟JSON数据的话，还要解析，对于雏形来说就不用了）。

<ol>
<li>实现发jsonp，跨域请求js
有了开始时的想法，做完雏形后，就开始想是否可以向百度后台发请求，实现suggestion。于是就开始看百度搜索时到底向后发送了什么请求。打开Firebug，看到输入“百”后，貌似向后台发了两条请求
<img src="http://img.blog.csdn.net/20140914111950781?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdGltX3RzYW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="此处输入图片的描述">
打开请求看了好久，也没看出点什么，未果，然后就打开“百度”，搜索了一番，发现了有用jsonp可以利用关键字获取百度suggestion数据的博文，认真的看了一番之后，发现了关键在向百度后台提交关键字的URL，在哪传值和如何获取返回的suggestion数据。然后试着直接访问<a href="http://suggestion.baidu.com/su">http://suggestion.baidu.com/su</a>
<img src="http://img.blog.csdn.net/20140914112145878?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdGltX3RzYW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="此处输入图片的描述">
下载后打开，发现了文件中只有一段行代码</li>
</ol>
</li>
</ol>

<div class="highlight highlight-javascript"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">baidu</span><span class="p">.</span><span class="nx">sug</span><span class="p">({</span><span class="nx">q</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span><span class="nx">p</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="nx">s</span><span class="o">:</span><span class="p">[]});</span> 
</pre></div>

<p>数组里面就是我们需要的suggestion数据。于是，发jsonp，跨域请求js，就可以获取到suggestion数据。</p>

<div class="highlight highlight-javascript"><pre><span class="kd">function</span> <span class="nx">fillUrls</span><span class="p">()</span> <span class="p">{</span>  
    <span class="kd">var</span> <span class="nx">strdomin</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">"#input_search"</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>  
    <span class="kd">var</span> <span class="nx">qsData</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'wd'</span><span class="o">:</span> <span class="nx">strdomin</span><span class="p">,</span> <span class="s1">'p'</span><span class="o">:</span> <span class="s1">'3'</span><span class="p">,</span> <span class="s1">'cb'</span><span class="o">:</span> <span class="s1">'findSuggestions'</span><span class="p">,</span> <span class="s1">'t'</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getMilliseconds</span><span class="p">().</span><span class="nx">toString</span><span class="p">()</span> <span class="p">};</span>  
  <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span><span class="c1">// 发jsonp（跨域请求js）  </span>
        <span class="nx">async</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>  
        <span class="nx">url</span><span class="o">:</span> <span class="s2">"http://suggestion.baidu.com/su"</span><span class="p">,</span>  
        <span class="nx">type</span><span class="o">:</span> <span class="s2">"GET"</span><span class="p">,</span>  
        <span class="nx">dataType</span><span class="o">:</span> <span class="s1">'jsonp'</span><span class="p">,</span>  
        <span class="nx">jsonp</span><span class="o">:</span> <span class="s1">'jsoncallback'</span><span class="p">,</span>  
        <span class="nx">data</span><span class="o">:</span> <span class="nx">qsData</span><span class="p">,</span>  
        <span class="nx">timeout</span><span class="o">:</span> <span class="mi">500</span><span class="p">,</span>  
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>  
        <span class="p">},</span>  
        <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">)</span> <span class="p">{</span>  
            <span class="nx">alert</span><span class="p">(</span><span class="nx">xhr</span><span class="p">);</span>  
        <span class="p">}</span>  
    <span class="p">});</span>  
<span class="p">}</span>  
</pre></div>

<p>用一个变量去接收suggestion数组里面的数据</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">urls</span> <span class="o">=</span> <span class="nx">strurls</span><span class="p">.</span><span class="nx">s</span><span class="p">;</span> 
</pre></div>

<p>最终效果如下
<img src="http://img.blog.csdn.net/20140914120227406?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdGltX3RzYW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="此处输入图片的描述">
用console.dir(strurls)将接收到的数据打印在控制台上也看到了返回的suggestion数据。</p>

<h3>
<a name="%E5%AE%8C%E6%88%90%E9%98%B6%E6%AE%B5%E5%90%91%E7%99%BE%E5%BA%A6%E5%90%8E%E5%8F%B0%E6%8F%90%E4%BA%A4%E6%90%9C%E7%B4%A2%E5%85%B3%E9%94%AE%E5%AD%97%E8%BF%9B%E8%A1%8C%E6%90%9C%E7%B4%A2" class="anchor" href="#%E5%AE%8C%E6%88%90%E9%98%B6%E6%AE%B5%E5%90%91%E7%99%BE%E5%BA%A6%E5%90%8E%E5%8F%B0%E6%8F%90%E4%BA%A4%E6%90%9C%E7%B4%A2%E5%85%B3%E9%94%AE%E5%AD%97%E8%BF%9B%E8%A1%8C%E6%90%9C%E7%B4%A2"><span class="octicon octicon-link"></span></a>③完成阶段（向百度后台提交搜索关键字进行搜索）</h3>

<ol>
<li>实现前的一些想法
在完成上面的成熟版之后，我想既然可以向后台提交关键字获取suggestion，应该也可以向后台提交关键字进行搜索的。（PS：好像这个并没有用到什么技术，但是觉得很有意思，就顺便做了，而且在实现的过程中也出现了一些问题，顺便也总结一下。）</li>
<li>实现过程
回想之前我们做项目时可以通过表单利用action向后台提交数据的。我打开Firebug，查看百度搜索时的传值情况，发现了百度搜索的action地址是<a href="http://www.baidu.com/s">http://www.baidu.com/s</a>
</li>
</ol>

<p><img src="http://img.blog.csdn.net/20140914120732312?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdGltX3RzYW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="此处输入图片的描述"></p>

<p>于是就试着去写一下，在</p>标签里加上了一句action="<a href="http://www.baidu.com/s%22%EF%BC%8C%E4%BD%86%E6%98%AF%EF%BC%8C%E6%8F%90%E4%BA%A4%E4%BA%86%E4%B9%8B%E5%90%8E%E5%8D%B4%E5%8F%98%E6%88%90%E7%99%BE%E5%BA%A6%E9%A6%96%E9%A1%B5%EF%BC%8C%E5%B9%B6%E6%B2%A1%E6%9C%89%E6%90%9C%E7%B4%A2%E3%80%82%E4%BA%8E%E6%98%AF%EF%BC%8C%E6%88%91%E5%8F%88%E6%89%93%E5%BC%80Firebug%EF%BC%8C%E6%9F%A5%E7%9C%8B%E7%99%BE%E5%BA%A6%E6%90%9C%E7%B4%A2%E7%9A%84%E4%BC%A0%E5%80%BC%E6%83%85%E5%86%B5">http://www.baidu.com/s"，但是，提交了之后却变成百度首页，并没有搜索。于是，我又打开Firebug，查看百度搜索的传值情况</a>

<p><img src="http://img.blog.csdn.net/20140914121429891?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdGltX3RzYW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="此处输入图片的描述"></p>

<p>发现有两个参数有我要搜索的字段“百度云”，分别是“bs”和“wd”
于是我就将输入框的mane的值改成以上两个值去试。发现“wd”就是关键字对应的字段，再查看了一下地址栏果然也没错，有传值。</p>

<p><img src="http://img.blog.csdn.net/20140914121537517?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdGltX3RzYW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="此处输入图片的描述"></p>

<p>然后我再试着直接去修改百度搜索地址栏的值</p>

<p><img src="http://img.blog.csdn.net/20140914121819367?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdGltX3RzYW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="此处输入图片的描述"></p>

<p>发现搜索果然出现了，原来“wd”就是百度后台接受搜索关键字的字段。</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/TimTsang/BaiduSuggestion/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/TimTsang/BaiduSuggestion/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/TimTsang/BaiduSuggestion"></a> is maintained by <a href="https://github.com/TimTsang">TimTsang</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
